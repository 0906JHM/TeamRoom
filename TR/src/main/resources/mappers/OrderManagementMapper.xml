<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mappers.OrderManagementMapper"> 
	 
	<insert id="insertOrderManagement">  
		insert into buy(buyNum,rawCode,rawName,rawType,clientCode,whseCode,whseCount,buyCount,rawPrice,buyDate,buyEmpId,buyInstate)
		values(#{buyNum},#{rawCode},#{rawName},#{rawType},#{clientCode},#{whseCode},#{whseCount},#{buyCount},#{rawPrice},#{buyDate},#{buyEmpId},#{buyInstate})
	</insert> 
 
	<!-- home 페이징처리, 검색기능 -->
	<select id="getOrderManagementList" resultType="com.itwillbs.domain.OrderManagementDTO">
		select *
		from buy 
		where 1=1
   		<if test="search1 != null and search1 != ''">
        	and buyNum like concat('%', #{search1}, '%')
    	</if>
    	<if test="search2 != null and search2 != ''">
        	and rawCode like concat('%', #{search2}, '%')
    	</if>
   		<if test="search3 != null and search3 != ''">
       		and rawType = #{search3}
    	</if>
    	<if test="search4 != null and search4 != ''">
    		and clientCode like concat('%', #{search4}, '%')
    	</if>
    	order by buyNum desc limit #{startRow}, #{pageSize}
	</select>
	
	<!-- home 페이징처리, 검색기능 -->
 	<select id="getOrderManagementCount" resultType="java.lang.Integer">
		select count(*)
      	from buy
     	where 1=1
   		<if test="search1 != null and search1 != ''">
        	and buyNum like concat('%', #{search1}, '%')
    	</if>
    	<if test="search2 != null and search2 != ''">
        	and rawCode like concat('%', #{search2}, '%')
    	</if>
   		<if test="search3 != null and search3 != ''">
       		and rawType = #{search3}
    	</if>
    	<if test="search4 != null and search4 != ''">
    		and clientCode like concat('%', #{search4}, '%')
    	</if>
    </select>
	
	<!-- 체크박스로 선택삭제 -->
    <delete id="delete">
        delete from buy
        where buyNum = #{buyNum}
    </delete>
    
    <select id="getDetail" resultType="com.itwillbs.domain.OrderManagementDTO">
		select *
		from buy
		where buyNum = #{buyNum}
	</select>
	
	<update id="updateOrderManagement">
		update buy
		set rawCode=#{rawCode}, rawName=#{rawName}, rawType=#{rawType}, clientCode=#{clientCode}, whseCount=#{whseCount}, buyCount=#{buyCount}, rawPrice=#{rawPrice}, buyDate=#{buyDate}, buyEmpId=#{buyEmpId}, buyInstate=#{buyInstate}
		where buyNum = #{buyNum}
	</update>
	
	<!-- 엑셀 -->
	<select id="getOrderManagementList2" resultType="com.itwillbs.domain.OrderManagementDTO">
		select *
		from buy
	</select>
	
	<update id="updateBuyInstate">
    UPDATE buy
    SET buyInstate = '발주완료'
    WHERE buyDate &lt;= #{today} AND buyInstate = '신청완료'
</update>
	
	
</mapper>